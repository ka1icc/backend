# Описание задания

## Что было дано

Два XML-файла — ответы от партнёра на поисковые запросы авиабилетов:
- **RS_Via-3.xml** — запрос туда-обратно (round-trip), вылет 22 октября, возврат 30 октября
- **RS_ViaOW.xml** — запрос только в одну сторону (one-way), вылет 27 октября

В каждом файле есть варианты перелётов (тег `<Flights>`) из Дубая (DXB) в Бангкок (BKK) через разные пересадочные пункты (Дели, Куала-Лумпур, Мумбаи, Маскат и т.д.) от разных авиакомпаний.

## Что нужно было сделать

Веб-сервис с тремя эндпоинтами:
1. Какие варианты перелёта DXB → BKK мы получили
2. Самый дорогой/дешёвый, быстрый/долгий и оптимальный
3. Чем отличаются результаты двух запросов

---

## Процесс разработки

### 1. Изучение XML

Сначала я разобралась со структурой XML. Каждый вариант перелёта выглядит примерно так:

```xml
<Flights>
    <OnwardPricedItinerary>
        <Flights>
            <Flight>
                <Carrier id="AI">AirIndia</Carrier>
                <FlightNumber>996</FlightNumber>
                <Source>DXB</Source>
                <Destination>DEL</Destination>
                <DepartureTimeStamp>2018-10-22T0005</DepartureTimeStamp>
                <ArrivalTimeStamp>2018-10-22T0445</ArrivalTimeStamp>
                ...
            </Flight>
            <Flight>...</Flight>  <!-- пересадка -->
        </Flights>
    </OnwardPricedItinerary>
    <ReturnPricedItinerary>...</ReturnPricedItinerary>  <!-- обратный, только в Via-3 -->
    <Pricing currency="SGD">
        <ServiceCharges type="SingleAdult" ChargeType="TotalAmount">546.80</ServiceCharges>
    </Pricing>
</Flights>
```

Важные моменты, которые я заметила:
- Формат времени нестандартный: `2018-10-22T0005` (без двоеточия) — нужно парсить вручную
- В RS_Via-3.xml есть `ReturnPricedItinerary` (обратный рейс), в RS_ViaOW.xml его нет
- Цена берётся из `ServiceCharges` с `type="SingleAdult"` и `ChargeType="TotalAmount"`
- Один перелёт — это цепочка сегментов (Flight), т.е. DXB→DEL→BKK — два сегмента с пересадкой

### 2. Архитектура

Решила разделить проект на слои:
- **models.py** — ORM-модель `FlightResult`. Сегменты рейсов храню в JSON-колонках (onward_segments, return_segments), потому что у них нет фиксированной длины и создавать отдельную таблицу для сегментов было бы избыточно
- **services/xml_parser.py** — парсинг XML и загрузка в БД. Фильтрует только маршруты DXB→BKK (первый сегмент вылетает из DXB, последний прилетает в BKK)
- **routes/flights.py** — три эндпоинта API
- **factory.py** — фабрика приложения. При старте создаёт таблицы и загружает данные из XML, если БД пустая

### 3. Логика эндпоинтов

**GET /api/flights** — просто достаю всё из БД, сортирую по цене.

**GET /api/flights/extremes** — сортировки по цене и длительности дают дешёвый/дорогой и быстрый/долгий. Для «оптимального» я нормализую оба параметра в диапазон от 0 до 1 и нахожу вариант с минимальной суммой. То есть оптимальный — это компромисс, он не самый дешёвый и не самый быстрый, но лучший по совокупности.

**GET /api/diff** — каждому варианту я присваиваю `route_key` (например, `AI996-DXB-DEL|AI332-DEL-BKK`). По этому ключу сравниваю два файла: что есть только в Via-3, что только в ViaOW, и для совпадающих маршрутов считаю разницу в цене и длительности.

